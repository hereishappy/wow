<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>Scaffolding Interview</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      background: #f4f4f4;
      padding: 30px;
    }

    input {
      font-size: 1rem;
      padding: 8px;
      margin: 5px;
      width: 250px;
    }

    button {
      font-size: 1rem;
      padding: 10px 25px;
      margin-top: 20px;
      background-color: #008cba;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    .answerBlock {
      background: #fff;
      padding: 15px;
      margin-top: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    audio, select {
      margin-top: 10px;
    }

    #questionBox {
      font-size: 1.5rem;
      margin: 20px;
    }

    #timer {
      font-size: 2rem;
      color: crimson;
    }
  </style>
</head>
<body>
  <h1>üé§ ‡§∏‡•ç‡§ï‡•à‡§´‡•ã‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó ‡§á‡§Ç‡§ü‡§∞‡§µ‡•ç‡§Ø‡•Ç - Cuplok System</h1>

  <div>
    <input type="text" id="candidateName" placeholder="‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç" oninput="checkFields()">
    <br>
    <input type="text" id="candidateMobile" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§≤‡§ø‡§ñ‡•á‡§Ç" oninput="checkFields()" maxlength="10">
    <br>
    <button id="startBtn" onclick="startInterview()" disabled>üî∞ ‡§á‡§Ç‡§ü‡§∞‡§µ‡•ç‡§Ø‡•Ç ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
  </div>

  <div id="questionBox"></div>
  <div id="timer">‚è≥</div>

  <div id="resultBox"></div>
  <div id="answersContainer"></div>

  <script>
    const questions = [
      "Cuplok ‡§∏‡•ç‡§ï‡•à‡§´‡•ã‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§ò‡§ü‡§ï ‡§ï‡•å‡§®-‡§ï‡•å‡§® ‡§∏‡•á ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç?",
      "Work at height ‡§ï‡§∞‡§§‡•á ‡§∏‡§Æ‡§Ø ‡§ï‡•å‡§®-‡§ï‡•å‡§® ‡§∏‡•á PPE ‡§ú‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à‡§Ç?",
      "Scaffolding inspection ‡§ï‡§ø‡§§‡§®‡•á ‡§∏‡§Æ‡§Ø ‡§Æ‡•á‡§Ç ‡§ï‡§∞‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è?",
      "Cuplok ‡§î‡§∞ Tubular ‡§∏‡•ç‡§ï‡•à‡§´‡•ã‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó ‡§Æ‡•á‡§Ç ‡§ï‡•ç‡§Ø‡§æ ‡§Ö‡§Ç‡§§‡§∞ ‡§π‡•à?",
      "Load bearing test ‡§ï‡§æ ‡§ï‡•ç‡§Ø‡§æ ‡§Æ‡§π‡§§‡•ç‡§µ ‡§π‡•à?",
      "Work at height ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•å‡§®-‡§ï‡•å‡§® ‡§∏‡•á safety tags ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç?",
      "Scaffolder ‡§ï‡•ã ‡§ï‡§ø‡§∏ certification ‡§ï‡•Ä ‡§ú‡§∞‡•Ç‡§∞‡§§ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à?",
      "Scaffolding ‡§ï‡•á base preparation ‡§Æ‡•á‡§Ç ‡§ï‡•ç‡§Ø‡§æ-‡§ï‡•ç‡§Ø‡§æ ‡§¶‡•á‡§ñ‡§®‡§æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à?",
      "Cuplok verticals ‡§î‡§∞ horizontals ‡§ï‡•à‡§∏‡•á fit ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç?",
      "Platform width ‡§ï‡§ø‡§§‡§®‡§æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è scaffold ‡§™‡§∞?"
    ];

    let current = 0;
    let shuffled = [];
    let recorder, audioChunks = [];
    let scores = [];
    let hindiVoice;

    window.speechSynthesis.onvoiceschanged = () => {
      const voices = speechSynthesis.getVoices();
      // Try to get a female Hindi voice
      hindiVoice = voices.find(voice =>
        voice.lang === "hi-IN" && voice.name.toLowerCase().includes("female")
      ) || voices.find(v => v.lang === "hi-IN") || voices[0];
    };

    function checkFields() {
      const name = document.getElementById("candidateName").value.trim();
      const mobile = document.getElementById("candidateMobile").value.trim();
      document.getElementById("startBtn").disabled = !(name && mobile.length === 10);
    }

    function startInterview() {
      shuffled = questions.sort(() => 0.5 - Math.random()).slice(0, 10);
      current = 0;
      scores = [];
      document.getElementById("startBtn").style.display = "none";
      document.getElementById("answersContainer").innerHTML = "";
      askQuestion();
    }

    function askQuestion() {
      if (current >= shuffled.length) {
        endInterview();
        return;
      }

      const q = shuffled[current];
      document.getElementById("questionBox").innerText = `‡§™‡•ç‡§∞‡§∂‡•ç‡§® ${current + 1}: ${q}`;
      speakQuestion(q); // üîä Speak Hindi voice
      startTimer(20);
      startRecording();
    }

    function speakQuestion(text) {
      const msg = new SpeechSynthesisUtterance();
      msg.text = text;
      msg.lang = "hi-IN";
      msg.voice = hindiVoice;
      msg.rate = 0.9;
      window.speechSynthesis.cancel(); // Stop previous speech if any
      window.speechSynthesis.speak(msg);
    }

    function startTimer(sec) {
      let timeLeft = sec;
      const timerEl = document.getElementById("timer");

      const interval = setInterval(() => {
        timerEl.innerText = `‚è≥ ${timeLeft} ‡§∏‡•á‡§ï‡§Ç‡§° ‡§∂‡•á‡§∑`;
        timeLeft--;

        if (timeLeft < 0) {
          clearInterval(interval);
          stopRecording();
        }
      }, 1000);
    }

    async function startRecording() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        recorder = new MediaRecorder(stream);
        audioChunks = [];

        recorder.ondataavailable = e => audioChunks.push(e.data);
        recorder.onstop = () => {
          const audioBlob = new Blob(audioChunks);
          const audioURL = URL.createObjectURL(audioBlob);

          const container = document.getElementById("answersContainer");
          const div = document.createElement("div");
          div.className = "answerBlock";

          const questionText = `<strong>‡§™‡•ç‡§∞‡§∂‡•ç‡§® ${current + 1}:</strong> ${shuffled[current]}`;
          const audio = `<audio controls src="${audioURL}"></audio>`;
          const scoreSelect = `
            <label>‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§¶‡•á‡§Ç: 
              <select onchange="updateScore(${current}, this.value)">
                <option value="">-- ‡§ö‡•Å‡§®‡•á‡§Ç --</option>
                ${[...Array(11).keys()].map(n => `<option value="${n}">${n}</option>`).join("")}
              </select>
            </label>
          `;

          div.innerHTML = `${questionText}<br>${audio}<br><br>${scoreSelect}`;
          container.appendChild(div);

          scores[current] = 0;
          current++;
          setTimeout(() => askQuestion(), 1000);
        };

        recorder.start();
      } catch (err) {
        alert("üé§ ‡§Æ‡§æ‡§á‡§ï ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä! ‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§¶‡•á‡§Ç‡•§");
      }
    }

    function stopRecording() {
      if (recorder && recorder.state === "recording") recorder.stop();
    }

    function updateScore(index, value) {
      scores[index] = parseInt(value) || 0;
    }

    function endInterview() {
      const total = scores.reduce((a, b) => a + b, 0);
      document.getElementById("questionBox").innerText = "‚úÖ ‡§á‡§Ç‡§ü‡§∞‡§µ‡•ç‡§Ø‡•Ç ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§π‡•ã ‡§ó‡§Ø‡§æ!";
      document.getElementById("timer").innerText = "";
      document.getElementById("startBtn").style.display = "block";
      document.getElementById("startBtn").innerText = "üîÅ ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§ï‡§∞‡•á‡§Ç";

      document.getElementById("resultBox").innerHTML = `
        <h2>‡§ï‡•Å‡§≤ ‡§∏‡•ç‡§ï‡•ã‡§∞: ${total} / 100</h2>
        <p>‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! ‡§Ü‡§™‡§®‡•á ‡§á‡§Ç‡§ü‡§∞‡§µ‡•ç‡§Ø‡•Ç ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§ø‡§Ø‡§æ‡•§</p>
      `;

      const candidate = document.getElementById("candidateName").value.trim();
      const mobile = document.getElementById("candidateMobile").value.trim();
      postToBlogger(candidate, mobile, total);
    }

    function postToBlogger(candidate, mobile, score) {
      fetch("https://script.google.com/macros/s/AKfycbyEHkluguvDcNGVQA3SqNX7xZWpchq2FRQWQTbGUtwvLhQyMFBDmKsazBGq9c_mHvRXgg/exec", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          candidate: candidate,
          mobile: mobile,
          score: score
        })
      })
      .then(res => res.text())
      .then(data => {
        alert("‚úÖ ‡§∏‡•ç‡§ï‡•ã‡§∞ Blogger ‡§™‡§∞ ‡§™‡•ã‡§∏‡•ç‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ!");
        console.log(data);
      })
      .catch(err => {
        alert("‚ùå ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ü‡§à!");
        console.error(err);
      });
    }
  </script>
</body>
</html>
