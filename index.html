<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI рд╕реНрдХреИрдлреЛрд▓реНрдбрд┐рдВрдЧ рдЗрдВрдЯрд░рд╡реНрдпреВ рд╕рд┐рд╕реНрдЯрдо</title>
  <style>
    /* [Same CSS as before тАУ no changes needed] */
    /* Your entire CSS remains unchanged from your original code */
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ЁЯПЧя╕П AI рд╕реНрдХреИрдлреЛрд▓реНрдбрд┐рдВрдЧ рдЗрдВрдЯрд░рд╡реНрдпреВ рд╕рд┐рд╕реНрдЯрдо</h1>
      <p>рдХрдкреНрд▓реЛрдХ рд╕реНрдХреИрдлреЛрд▓реНрдбрд┐рдВрдЧ рдФрд░ рдКрдВрдЪрд╛рдИ рдкрд░ рдХрд╛рдо рдХреЗ рд▓рд┐рдП рдЗрдВрдЯрд░рд╡реНрдпреВ</p>
    </div>

    <div class="content">
      <!-- Registration Section -->
      <div class="section active" id="registration">
        <h2 style="text-align: center; margin-bottom: 30px; color: #333;">рдЙрдореНрдореАрджрд╡рд╛рд░ рдкрдВрдЬреАрдХрд░рдг</h2>
        <form id="candidateForm">
          <div class="form-group">
            <label for="name">рдкреВрд░рд╛ рдирд╛рдо *</label>
            <input type="text" id="name" name="name" required />
          </div>
          <div class="form-group">
            <label for="mobile">рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░ *</label>
            <input type="tel" id="mobile" name="mobile" required />
          </div>
          <div class="form-group">
            <label for="email">рдИрдореЗрд▓ рдЖрдИрдбреА</label>
            <input type="email" id="email" name="email" />
          </div>
          <div class="form-group">
            <label for="experience">рд╕реНрдХреИрдлреЛрд▓реНрдбрд┐рдВрдЧ рдЕрдиреБрднрд╡ (рд╡рд░реНрд╖реЛрдВ рдореЗрдВ)</label>
            <input type="text" id="experience" name="experience" placeholder="рдЙрджрд╛рд╣рд░рдг: 2 рд╕рд╛рд▓" />
          </div>
          <div class="form-group">
            <label for="location">рдХрд╛рд░реНрдп рд╕реНрдерд╛рди</label>
            <input type="text" id="location" name="location" placeholder="рдЙрджрд╛рд╣рд░рдг: рдореБрдВрдмрдИ, рджрд┐рд▓реНрд▓реА" />
          </div>
          <div style="text-align: center;">
            <button type="submit" class="btn">рдЗрдВрдЯрд░рд╡реНрдпреВ рд╢реБрд░реВ рдХрд░реЗрдВ</button>
          </div>
        </form>
      </div>

      <!-- Interview Section -->
      <div class="section" id="interview">
        <div class="permission-note">
          <strong>рдорд╣рддреНрд╡рдкреВрд░реНрдг:</strong> рдЗрдВрдЯрд░рд╡реНрдпреВ рдХреЗ рд▓рд┐рдП рдХреИрдорд░рд╛ рдФрд░ рдорд╛рдЗрдХреНрд░реЛрдлреЛрди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВред рдкреНрд░рд╢реНрди рдкреВрдЫрдиреЗ рдХреЗ рдмрд╛рдж рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдЕрдкрдиреЗ рдЖрдк рд╢реБрд░реВ рд╣реЛ рдЬрд╛рдПрдЧреАред
        </div>

        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="ai-speaking" id="aiSpeaking">
          <span>ЁЯОд AI рдкреНрд░рд╢реНрди рдкреВрдЫ рд░рд╣рд╛ рд╣реИ...</span>
        </div>

        <div class="recording-timer" id="recordingTimer">
          <span>ЁЯФ┤ рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдЪрд▓ рд░рд╣реА рд╣реИ - рд╕рдордп: <span id="timerDisplay">00:00</span></span>
        </div>

        <div class="video-container">
          <video id="videoElement" autoplay muted></video>
          <div class="ai-avatar">ЁЯСйтАНЁЯПл</div>
        </div>

        <div class="question-container">
          <div class="question-counter" id="questionCounter">рдкреНрд░рд╢реНрди 1/10</div>
          <div class="question-text" id="questionText">рдЗрдВрдЯрд░рд╡реНрдпреВ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реЛ рдЬрд╛рдЗрдП...</div>
        </div>

        <div class="status-indicator" id="statusIndicator">
          <div class="status-dot" id="statusDot"></div>
          <span id="statusText">рддреИрдпрд╛рд░ рд╣реЛ рд░рд╣рд╛ рд╣реИ...</span>
        </div>

        <div class="controls">
          <button class="btn" id="startBtn" onclick="startInterview()">рдЗрдВрдЯрд░рд╡реНрдпреВ рд╢реБрд░реВ рдХрд░реЗрдВ</button>
          <button class="btn" id="nextBtn" onclick="nextQuestion()" style="display: none;">рдЕрдЧрд▓рд╛ рдкреНрд░рд╢реНрди</button>
        </div>
      </div>

      <!-- Results Section -->
      <div class="section" id="results">
        <div class="result-container">
          <div class="result-icon">ЁЯОЙ</div>
          <div class="result-text">рдмрдзрд╛рдИ рд╣реЛ! рдЖрдкрдХрд╛ рдЗрдВрдЯрд░рд╡реНрдпреВ рдкреВрд░рд╛ рд╣реЛ рдЧрдпрд╛ рд╣реИред</div>
          <p style="margin-bottom: 20px;">рдЖрдкрдХреЗ рдЬрд╡рд╛рдм Google Sheets рдореЗрдВ рд╕реЗрд╡ рд╣реЛ рдЧрдП рд╣реИрдВред рдкрд░рд┐рдгрд╛рдо рдЬрд▓реНрдж рд╣реА рдЖрдкрдХреЛ рдмрддрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред</p>
          <button class="btn" onclick="restartInterview()">рдирдпрд╛ рдЗрдВрдЯрд░рд╡реНрдпреВ рд╢реБрд░реВ рдХрд░реЗрдВ</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentQuestion = 0;
    let candidateData = {};
    let mediaRecorder;
    let recordedChunks = [];
    let isRecording = false;
    let stream;
    let interviewAnswers = [];
    let recordingTimer;
    let recordingStartTime;
    let currentSpeechUtterance;

    const questions = [
      "рдХрдкреНрд▓реЛрдХ рд╕реНрдХреИрдлреЛрд▓реНрдбрд┐рдВрдЧ рдХреНрдпрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреНрдпреЛрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ?",
      "рдКрдВрдЪрд╛рдИ рдкрд░ рдХрд╛рдо рдХрд░рддреЗ рд╕рдордп рдХреМрди рд╕реЗ рдореБрдЦреНрдп рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдЕрдкрдирд╛рдиреЗ рдЪрд╛рд╣рд┐рдП?",
      "рдХрдкреНрд▓реЛрдХ рд╕реНрдХреИрдлреЛрд▓реНрдбрд┐рдВрдЧ рдХреЗ рдореБрдЦреНрдп рдХрдВрдкреЛрдиреЗрдВрдЯ рдХреМрди рд╕реЗ рд╣реИрдВ?",
      "рд╕реНрдХреИрдлреЛрд▓реНрдбрд┐рдВрдЧ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐рди рдЪреАрдЬреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП?",
      "PPE (Personal Protective Equipment) рдореЗрдВ рдХреМрди рд╕реЗ рдЖрдЗрдЯрдо рд╢рд╛рдорд┐рд▓ рд╣реЛрддреЗ рд╣реИрдВ?",
      "рд╕реНрдХреИрдлреЛрд▓реНрдбрд┐рдВрдЧ рдкрд░ рдХрд╛рдо рдХрд░рддреЗ рд╕рдордп рдХрд┐рддрдирд╛ рд╡рдЬрди рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ?",
      "рдпрджрд┐ рд╕реНрдХреИрдлреЛрд▓реНрдбрд┐рдВрдЧ рдореЗрдВ рдХреЛрдИ рдХрдореА рдпрд╛ рдЦрд░рд╛рдмреА рджрд┐рдЦреЗ рддреЛ рдХреНрдпрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП?",
      "рдХрдкреНрд▓реЛрдХ рд╕рд┐рд╕реНрдЯрдо рдХреА рдордЬрдмреВрддреА рдХреИрд╕реЗ рдЪреЗрдХ рдХрд░рддреЗ рд╣реИрдВ?",
      "рдмрд╛рд░рд┐рд╢ рдпрд╛ рддреЗрдЬ рд╣рд╡рд╛ рдХреЗ рджреМрд░рд╛рди рд╕реНрдХреИрдлреЛрд▓реНрдбрд┐рдВрдЧ рдкрд░ рдХрд╛рдо рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдпрд╛ рдирд╣реАрдВ?",
      "рд╕реНрдХреИрдлреЛрд▓реНрдбрд┐рдВрдЧ рд╕реЗ рдЧрд┐рд░рдиреЗ рдпрд╛ рдЪреЛрдЯ рд▓рдЧрдиреЗ рдкрд░ рддреБрд░рдВрдд рдХреНрдпрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП?",
      "рдЯрд╛рдИ-рд░реЙрдбреНрд╕ рдФрд░ рдмреНрд░реЗрд╕рд┐рдВрдЧ рдХрд╛ рдХреНрдпрд╛ рдорд╣рддреНрд╡ рд╣реИ?",
      "Base plate рдФрд░ sole plate рдореЗрдВ рдХреНрдпрд╛ рдЕрдВрддрд░ рд╣реИ?",
      "рд╕реНрдХреИрдлреЛрд▓реНрдбрд┐рдВрдЧ рдХреА рд╕рд╣реА height рдХреИрд╕реЗ maintain рдХрд░рддреЗ рд╣реИрдВ?",
      "Ledger рдФрд░ transom рдХрд╛ рдХреНрдпрд╛ рдХрд╛рдо рд╣реИ?",
      "Safety harness рдХреИрд╕реЗ рдкрд╣рдирдирд╛ рдЪрд╛рд╣рд┐рдП?",
      "рдЬрдореАрди рдХреА рдЬрд╛рдВрдЪ рдХреНрдпреЛрдВ рдЬрд░реВрд░реА рд╣реИ рд╕реНрдХреИрдлреЛрд▓реНрдбрд┐рдВрдЧ рд▓рдЧрд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ?",
      "рд╕реНрдХреИрдлреЛрд▓реНрдбрд┐рдВрдЧ рдкрд░ tools рдХреИрд╕реЗ рд░рдЦрдиреЗ рдЪрд╛рд╣рд┐рдП?",
      "Fall arrest system рдХреНрдпрд╛ рд╣реИ?",
      "рд╕реНрдХреИрдлреЛрд▓реНрдбрд┐рдВрдЧ рдХреЛ рдХреИрд╕реЗ dismantle рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП?",
      "Emergency рдХреЗ рджреМрд░рд╛рди рдХреИрд╕реЗ рдЬрд▓реНрджреА рдиреАрдЪреЗ рдЖрдирд╛ рдЪрд╛рд╣рд┐рдП?"
    ];

    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    const selectedQuestions = shuffleArray(questions).slice(0, 10);

    document.getElementById('candidateForm').addEventListener('submit', function(e) {
      e.preventDefault();
      candidateData = {
        name: document.getElementById('name').value,
        mobile: document.getElementById('mobile').value,
        email: document.getElementById('email').value,
        experience: document.getElementById('experience').value,
        location: document.getElementById('location').value,
        timestamp: new Date().toISOString(),
        interviewId: 'INT_' + Date.now()
      };
      showSection('interview');
      setupCamera();
    });

    async function setupCamera() {
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        document.getElementById('videoElement').srcObject = stream;
        document.getElementById('statusText').textContent = 'рдХреИрдорд░рд╛ рддреИрдпрд╛рд░ рд╣реИ - рдЗрдВрдЯрд░рд╡реНрдпреВ рд╢реБрд░реВ рдХрд░реЗрдВ';
        document.getElementById('startBtn').style.display = 'block';
      } catch (err) {
        console.error('Camera access error:', err);
        document.getElementById('statusText').textContent = 'рдХреИрдорд░рд╛ рдПрдХреНрд╕реЗрд╕ рдореЗрдВ рд╕рдорд╕реНрдпрд╛ - рдХреГрдкрдпрд╛ рдЕрдиреБрдорддрд┐ рджреЗрдВ';
      }
    }

    function startInterview() {
      document.getElementById('startBtn').style.display = 'none';
      document.getElementById('nextBtn').style.display = 'block';
      currentQuestion = 0;
      showQuestion();
      updateProgress();
    }

    function showQuestion() {
      if (currentQuestion < selectedQuestions.length) {
        document.getElementById('questionCounter').textContent = `рдкреНрд░рд╢реНрди ${currentQuestion + 1}/10`;
        document.getElementById('questionText').textContent = selectedQuestions[currentQuestion];
        document.getElementById('aiSpeaking').style.display = 'block';
        document.getElementById('recordingTimer').style.display = 'none';
        if (isRecording) {
          stopRecording();
        }
        speakQuestionAndRecord(selectedQuestions[currentQuestion]);
      } else {
        completeInterview();
      }
    }

    function speakQuestionAndRecord(text) {
      if ('speechSynthesis' in window) {
        window.speechSynthesis.cancel();
        currentSpeechUtterance = new SpeechSynthesisUtterance(text);
        currentSpeechUtterance.lang = 'hi-IN';
        currentSpeechUtterance.rate = 0.8;
        currentSpeechUtterance.pitch = 1.1;
        currentSpeechUtterance.onend = function() {
          document.getElementById('aiSpeaking').style.display = 'none';
          setTimeout(() => startRecording(), 1000);
        };
        window.speechSynthesis.speak(currentSpeechUtterance);
      } else {
        document.getElementById('aiSpeaking').style.display = 'none';
        setTimeout(() => startRecording(), 2000);
      }
    }

    function startRecording() {
      if (isRecording) return;
      recordedChunks = [];
      mediaRecorder = new MediaRecorder(stream);
      mediaRecorder.ondataavailable = function(event) {
        if (event.data.size > 0) recordedChunks.push(event.data);
      };
      mediaRecorder.onstop = function() {
        const blob = new Blob(recordedChunks, { type: 'video/webm' });
        interviewAnswers.push({
          questionNumber: currentQuestion + 1,
          question: selectedQuestions[currentQuestion],
          recordingBlob: blob,
          recordingDuration: getRecordingDuration(),
          timestamp: new Date().toISOString()
        });
      };
      mediaRecorder.start();
      isRecording = true;
      recordingStartTime = Date.now();
      document.getElementById('recordingTimer').style.display = 'block';
      document.getElementById('statusText').textContent = 'рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдЪрд▓ рд░рд╣реА рд╣реИ - рдЕрдкрдирд╛ рдЬрд╡рд╛рдм рджреЗрдВ';
      document.getElementById('statusDot').classList.add('recording');
      startRecordingTimer();
    }

    function stopRecording() {
      if (mediaRecorder && mediaRecorder.state !== 'inactive') {
        mediaRecorder.stop();
        isRecording = false;
        document.getElementById('recordingTimer').style.display = 'none';
        document.getElementById('statusText').textContent = 'рдЬрд╡рд╛рдм рд░рд┐рдХреЙрд░реНрдб рд╣реЛ рдЧрдпрд╛';
        document.getElementById('statusDot').classList.remove('recording');
        if (recordingTimer) clearInterval(recordingTimer);
      }
    }

    function startRecordingTimer() {
      recordingTimer = setInterval(() => {
        const elapsed = Date.now() - recordingStartTime;
        const minutes = Math.floor(elapsed / 60000);
        const seconds = Math.floor((elapsed % 60000) / 1000);
        document.getElementById('timerDisplay').textContent =
          `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      }, 1000);
    }

    function getRecordingDuration() {
      return recordingStartTime ? Date.now() - recordingStartTime : 0;
    }

    function nextQuestion() {
      if (isRecording) stopRecording();
      if (window.speechSynthesis) window.speechSynthesis.cancel();
      currentQuestion++;
      showQuestion();
      updateProgress();
    }

    function updateProgress() {
      const progress = ((currentQuestion + 1) / selectedQuestions.length) * 100;
      document.getElementById('progressFill').style.width = progress + '%';
    }

    function completeInterview() {
      if (isRecording) stopRecording();
      if (window.speechSynthesis) window.speechSynthesis.cancel();
      saveToGoogleSheets();
      if (stream) stream.getTracks().forEach(track => track.stop());
      showSection('results');
    }

    function saveToGoogleSheets() {
      const finalData = {
        candidate: candidateData,
        answers: interviewAnswers.map(answer => ({
          questionNumber: answer.questionNumber,
          question: answer.question,
          recordingDuration: answer.recordingDuration,
          timestamp: answer.timestamp
        })),
        completedAt: new Date().toISOString()
      };
      console.log('Data to save:', finalData);
    }

    function showSection(sectionId) {
      document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
      });
      document.getElementById(sectionId).classList.add('active');
    }

    function restartInterview() {
      location.reload();
    }

    document.addEventListener('DOMContentLoaded', () => {
      console.log('Scaffolding Interview App Initialized');
    });
  </script>
</body>
</html>