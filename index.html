<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>Scaffolding Interview</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      background: #f4f4f4;
      padding: 30px;
    }

    input {
      font-size: 1rem;
      padding: 8px;
      margin: 5px;
      width: 250px;
    }

    button {
      font-size: 1rem;
      padding: 10px 25px;
      margin-top: 20px;
      background-color: #008cba;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    .answerBlock {
      background: #fff;
      padding: 15px;
      margin-top: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    audio, select {
      margin-top: 10px;
    }

    #questionBox {
      font-size: 1.5rem;
      margin: 20px;
    }

    #timer {
      font-size: 2rem;
      color: crimson;
    }
  </style>
</head>
<body>
  <h1>ЁЯОд рд╕реНрдХреИрдлреЛрд▓реНрдбрд┐рдВрдЧ рдЗрдВрдЯрд░рд╡реНрдпреВ - Cuplok System</h1>

  <div>
    <input type="text" id="candidateName" placeholder="рдирд╛рдо рд▓рд┐рдЦреЗрдВ" oninput="checkFields()">
    <br>
    <input type="text" id="candidateMobile" placeholder="рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░ рд▓рд┐рдЦреЗрдВ" oninput="checkFields()" maxlength="10">
    <br>
    <button id="startBtn" onclick="startInterview()" disabled>ЁЯФ░ рдЗрдВрдЯрд░рд╡реНрдпреВ рд╢реБрд░реВ рдХрд░реЗрдВ</button>
  </div>

  <div id="questionBox"></div>
  <div id="timer">тП│</div>

  <div id="resultBox"></div>
  <div id="answersContainer"></div>

  <script>
    const questions = [
      "Cuplok рд╕реНрдХреИрдлреЛрд▓реНрдбрд┐рдВрдЧ рдХреЗ рдореБрдЦреНрдп рдШрдЯрдХ рдХреМрди-рдХреМрди рд╕реЗ рд╣реЛрддреЗ рд╣реИрдВ?",
      "Work at height рдХрд░рддреЗ рд╕рдордп рдХреМрди-рдХреМрди рд╕реЗ PPE рдЬрд░реВрд░реА рд╣реИрдВ?",
      "Scaffolding inspection рдХрд┐рддрдиреЗ рд╕рдордп рдореЗрдВ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП?",
      "Cuplok рдФрд░ Tubular рд╕реНрдХреИрдлреЛрд▓реНрдбрд┐рдВрдЧ рдореЗрдВ рдХреНрдпрд╛ рдЕрдВрддрд░ рд╣реИ?",
      "Load bearing test рдХрд╛ рдХреНрдпрд╛ рдорд╣рддреНрд╡ рд╣реИ?",
      "Work at height рдХреЗ рд▓рд┐рдП рдХреМрди-рдХреМрди рд╕реЗ safety tags рд╣реЛрддреЗ рд╣реИрдВ?",
      "Scaffolder рдХреЛ рдХрд┐рд╕ certification рдХреА рдЬрд░реВрд░рдд рд╣реЛрддреА рд╣реИ?",
      "Scaffolding рдХреЗ base preparation рдореЗрдВ рдХреНрдпрд╛-рдХреНрдпрд╛ рджреЗрдЦрдирд╛ рд╣реЛрддрд╛ рд╣реИ?",
      "Cuplok verticals рдФрд░ horizontals рдХреИрд╕реЗ fit рд╣реЛрддреЗ рд╣реИрдВ?",
      "Platform width рдХрд┐рддрдирд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП scaffold рдкрд░?"
    ];

    let current = 0;
    let shuffled = [];
    let recorder, audioChunks = [];
    let scores = [];
    let interviewAnswers = [];
    let hindiVoice;

    window.speechSynthesis.onvoiceschanged = () => {
      const voices = speechSynthesis.getVoices();
      hindiVoice = voices.find(voice =>
        voice.lang === "hi-IN" && voice.name.toLowerCase().includes("female")
      ) || voices.find(v => v.lang === "hi-IN") || voices[0];
    };

    function checkFields() {
      const name = document.getElementById("candidateName").value.trim();
      const mobile = document.getElementById("candidateMobile").value.trim();
      document.getElementById("startBtn").disabled = !(name && mobile.length === 10);
    }

    function startInterview() {
      shuffled = questions.sort(() => 0.5 - Math.random()).slice(0, 10);
      current = 0;
      scores = [];
      interviewAnswers = [];
      document.getElementById("startBtn").style.display = "none";
      document.getElementById("answersContainer").innerHTML = "";
      askQuestion();
    }

    function askQuestion() {
      if (current >= shuffled.length) {
        endInterview();
        return;
      }

      const q = shuffled[current];
      document.getElementById("questionBox").innerText = `рдкреНрд░рд╢реНрди ${current + 1}: ${q}`;
      speakQuestion(q);
      startTimer(20);
      startRecording();
    }

    function speakQuestion(text) {
      const msg = new SpeechSynthesisUtterance();
      msg.text = text;
      msg.lang = "hi-IN";
      msg.voice = hindiVoice;
      msg.rate = 0.9;
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(msg);
    }

    function startTimer(sec) {
      let timeLeft = sec;
      const timerEl = document.getElementById("timer");

      const interval = setInterval(() => {
        timerEl.innerText = `тП│ ${timeLeft} рд╕реЗрдХрдВрдб рд╢реЗрд╖`;
        timeLeft--;

        if (timeLeft < 0) {
          clearInterval(interval);
          stopRecording();
        }
      }, 1000);
    }

    async function startRecording() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        recorder = new MediaRecorder(stream);
        audioChunks = [];

        recorder.ondataavailable = e => audioChunks.push(e.data);
        recorder.onstop = () => {
          const audioBlob = new Blob(audioChunks);
          const audioURL = URL.createObjectURL(audioBlob);

          const container = document.getElementById("answersContainer");
          const div = document.createElement("div");
          div.className = "answerBlock";

          const questionText = `<strong>рдкреНрд░рд╢реНрди ${current + 1}:</strong> ${shuffled[current]}`;
          const audio = `<audio controls src="${audioURL}"></audio>`;
          const scoreSelect = `
            <label>рд╕реНрдХреЛрд░ рджреЗрдВ: 
              <select onchange="updateScore(${current}, this.value)">
                <option value="">-- рдЪреБрдиреЗрдВ --</option>
                ${[...Array(11).keys()].map(n => `<option value="${n}">${n}</option>`).join("")}
              </select>
            </label>
          `;

          div.innerHTML = `${questionText}<br>${audio}<br><br>${scoreSelect}`;
          container.appendChild(div);

          interviewAnswers.push({
            question: shuffled[current],
            audioURL: audioURL
          });

          scores[current] = 0;
          current++;
          setTimeout(() => askQuestion(), 1000);
        };

        recorder.start();
      } catch (err) {
        alert("ЁЯОд рдорд╛рдЗрдХ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рдорд┐рд▓реА! рдХреГрдкрдпрд╛ рдПрдХреНрд╕реЗрд╕ рджреЗрдВред");
      }
    }

    function stopRecording() {
      if (recorder && recorder.state === "recording") recorder.stop();
    }

    function updateScore(index, value) {
      scores[index] = parseInt(value) || 0;
    }

    function calculateScore() {
      return scores.reduce((a, b) => a + b, 0);
    }

    function endInterview() {
      const total = calculateScore();
      document.getElementById("questionBox").innerText = "тЬЕ рдЗрдВрдЯрд░рд╡реНрдпреВ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЧрдпрд╛!";
      document.getElementById("timer").innerText = "";
      document.getElementById("startBtn").style.display = "block";
      document.getElementById("startBtn").innerText = "ЁЯФБ рдлрд┐рд░ рд╕реЗ рдХрд░реЗрдВ";

      document.getElementById("resultBox").innerHTML = `
        <h2>рдХреБрд▓ рд╕реНрдХреЛрд░: ${total} / 100</h2>
        <p>рдзрдиреНрдпрд╡рд╛рдж! рдЖрдкрдиреЗ рдЗрдВрдЯрд░рд╡реНрдпреВ рдкреВрд░рд╛ рдХрд┐рдпрд╛ред</p>
      `;

      const candidateData = {
        name: document.getElementById("candidateName").value.trim(),
        mobile: document.getElementById("candidateMobile").value.trim()
      };

      saveInterviewData(candidateData);
    }

    function saveInterviewData(candidateData) {
      const score = calculateScore();

      fetch('https://script.google.com/macros/s/AKfycbyEHkluguvDcNGVQA3SqNX7xZWpchq2FRQWQTbGUtwvLhQyMFBDmKsazBGq9c_mHvRXgg/exec', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          candidate: candidateData.name,
          mobile: candidateData.mobile,
          score: score
        })
      })
      .then(res => res.text())
      .then(response => {
        console.log('тЬЕ Score posted to Blogger:', response);
        alert("тЬЕ рдЗрдВрдЯрд░рд╡реНрдпреВ рд╕реНрдХреЛрд░ Blogger рдкрд░ рдкреЛрд╕реНрдЯ рд╣реЛ рдЧрдпрд╛!");
      })
      .catch(error => {
        console.error('тЭМ рдкреЛрд╕реНрдЯ рдХрд░рдиреЗ рдореЗрдВ рд╕рдорд╕реНрдпрд╛:', error);
        alert("тЭМ Blogger рдкрд░ рдкреЛрд╕реНрдЯ рдирд╣реАрдВ рд╣реЛ рдкрд╛рдпрд╛ред");
      });
    }
  </script>
</body>
</html>
