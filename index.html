<!DOCTYPE html>

<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ‡§∏‡•ç‡§ï‡•à‡§´‡•ã‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó ‡§á‡§Ç‡§ü‡§∞‡§µ‡•ç‡§Ø‡•Ç ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            max-width: 1000px;
            width: 90%;
            min-height: 600px;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .content {
            padding: 40px;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
            font-size: 1.1rem;
        }

        input[type="text"], input[type="tel"], input[type="email"] {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus, input[type="tel"]:focus, input[type="email"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .video-container {
            position: relative;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        #videoElement {
            width: 100%;
            height: 400px;
            object-fit: cover;
        }

        .ai-avatar {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .question-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .question-counter {
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 15px;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #28a745;
            animation: blink 1s infinite;
        }

        .status-dot.recording {
            background: #dc3545;
            animation: recordingPulse 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        @keyframes recordingPulse {
            0%, 100% { transform: scale(1); background: #dc3545; }
            50% { transform: scale(1.3); background: #ff6b6b; }
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }

        .result-container {
            text-align: center;
            padding: 40px;
        }

        .result-icon {
            font-size: 5rem;
            margin-bottom: 20px;
        }

        .result-text {
            font-size: 1.5rem;
            margin-bottom: 30px;
            color: #333;
        }

        .permission-note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            color: #856404;
        }

        .recording-timer {
            background: #dc3545;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 20px;
            display: none;
        }

        .ai-speaking {
            background: #17a2b8;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 20px;
            display: none;
        }

        .category-badge {
            background: #28a745;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }

        .sync-status {
            background: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            color: #495057;
            text-align: center;
        }

        .sync-status.success {
            background: #d1edff;
            border-color: #bee5eb;
            color: #0c5460;
        }

        .sync-status.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .container {
                width: 95%;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .content {
                padding: 20px;
            }
            
            .ai-avatar {
                width: 80px;
                height: 80px;
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèóÔ∏è AI ‡§∏‡•ç‡§ï‡•à‡§´‡•ã‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó ‡§á‡§Ç‡§ü‡§∞‡§µ‡•ç‡§Ø‡•Ç ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ</h1>
            <p>‡§ï‡§™‡•ç‡§≤‡•ã‡§ï ‡§∏‡•ç‡§ï‡•à‡§´‡•ã‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó ‡§î‡§∞ ‡§ä‡§Ç‡§ö‡§æ‡§à ‡§™‡§∞ ‡§ï‡§æ‡§Æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡•ç‡§Ø‡§æ‡§™‡§ï ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§á‡§Ç‡§ü‡§∞‡§µ‡•ç‡§Ø‡•Ç</p>
        </div>

        <div class="content">
            <div class="section active" id="registration">
                <h2 style="text-align: center; margin-bottom: 30px; color: #333;">‡§â‡§Æ‡•ç‡§Æ‡•Ä‡§¶‡§µ‡§æ‡§∞ ‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£</h2>
                <form id="candidateForm">
                    <div class="form-group">
                        <label for="name">‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ *</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="mobile">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ *</label>
                        <input type="tel" id="mobile" name="mobile" required>
                    </div>
                    <div class="form-group">
                        <label for="email">‡§à‡§Æ‡•á‡§≤ ‡§Ü‡§à‡§°‡•Ä</label>
                        <input type="email" id="email" name="email">
                    </div>
                    <div class="form-group">
                        <label for="experience">‡§∏‡•ç‡§ï‡•à‡§´‡•ã‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó ‡§Ö‡§®‡•Å‡§≠‡§µ (‡§µ‡§∞‡•ç‡§∑‡•ã‡§Ç ‡§Æ‡•á‡§Ç)</label>
                        <input type="text" id="experience" name="experience" placeholder="‡§â‡§¶‡§æ‡§π‡§∞‡§£: 2 ‡§∏‡§æ‡§≤">
                    </div>
                    <div class="form-group">
                        <label for="location">‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§∏‡•ç‡§•‡§æ‡§®</label>
                        <input type="text" id="location" name="location" placeholder="‡§â‡§¶‡§æ‡§π‡§∞‡§£: ‡§Æ‡•Å‡§Ç‡§¨‡§à, ‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä">
                    </div>
                    <div style="text-align: center;">
                        <button type="submit" class="btn">‡§á‡§Ç‡§ü‡§∞‡§µ‡•ç‡§Ø‡•Ç ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
                    </div>
                </form>
            </div>

            <div class="section" id="interview">
                <div class="permission-note">
                    <strong>‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£:</strong> ‡§á‡§Ç‡§ü‡§∞‡§µ‡•ç‡§Ø‡•Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•à‡§Æ‡§∞‡§æ ‡§î‡§∞ ‡§Æ‡§æ‡§á‡§ï‡•ç‡§∞‡•ã‡§´‡•ã‡§® ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§Ç‡•§ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§™‡•Ç‡§õ‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°‡§ø‡§Ç‡§ó ‡§Ö‡§™‡§®‡•á ‡§Ü‡§™ ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã ‡§ú‡§æ‡§è‡§ó‡•Ä‡•§
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                
                <div class="ai-speaking" id="aiSpeaking">
                    <span>üé§ AI ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§™‡•Ç‡§õ ‡§∞‡§π‡§æ ‡§π‡•à...</span>
                </div>
                
                <div class="recording-timer" id="recordingTimer">
                    <span>üî¥ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°‡§ø‡§Ç‡§ó ‡§ö‡§≤ ‡§∞‡§π‡•Ä ‡§π‡•à - ‡§∏‡§Æ‡§Ø: <span id="timerDisplay">00:00</span></span>
                </div>
                
                <div class="video-container">
                    <video id="videoElement" autoplay muted></video>
                    <div class="ai-avatar">üë©‚Äçüè´</div>
                </div>
                
                <div class="question-container">
                    <div class="category-badge" id="categoryBadge">‡§¨‡•Å‡§®‡§ø‡§Ø‡§æ‡§¶‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä</div>
                    <div class="question-counter" id="questionCounter">‡§™‡•ç‡§∞‡§∂‡•ç‡§® 1/15</div>
                    <div class="question-text" id="questionText">‡§á‡§Ç‡§ü‡§∞‡§µ‡•ç‡§Ø‡•Ç ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•ã ‡§ú‡§æ‡§á‡§è...</div>
                </div>
                
                <div class="status-indicator" id="statusIndicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</span>
                </div>
                
                <div class="controls">
                    <button class="btn" id="startBtn" onclick="startInterview()">‡§á‡§Ç‡§ü‡§∞‡§µ‡•ç‡§Ø‡•Ç ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
                    <button class="btn" id="nextBtn" onclick="nextQuestion()" style="display: none;">‡§Ö‡§ó‡§≤‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®</button>
                </div>
            </div>

            <div class="section" id="results">
                <div class="result-container">
                    <div class="sync-status" id="syncStatus">
                        <span>üìä ‡§°‡•á‡§ü‡§æ Google Sheet ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</span>
                    </div>
                    <div class="result-icon">üéâ</div>
                    <div class="result-text">‡§¨‡§ß‡§æ‡§à ‡§π‡•ã! ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§ï‡•à‡§´‡•ã‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§á‡§Ç‡§ü‡§∞‡§µ‡•ç‡§Ø‡•Ç ‡§™‡•Ç‡§∞‡§æ ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§</div>
                    <p style="margin-bottom: 20px;">‡§Ü‡§™‡§ï‡•á ‡§∏‡§≠‡•Ä ‡§ú‡§µ‡§æ‡§¨ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§π‡•ã ‡§ó‡§è ‡§π‡•à‡§Ç ‡§î‡§∞ Google Sheet ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§è ‡§π‡•à‡§Ç‡•§</p>
                    <button class="btn" onclick="restartInterview()">‡§®‡§Ø‡§æ ‡§á‡§Ç‡§ü‡§∞‡§µ‡•ç‡§Ø‡•Ç ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
                </div>
            </div>
        </div>
    </div>

<script>
    // IMPORTANT: Replace this with your Google Apps Script Web App URL
    // This URL will be used to send data (including links to recordings) to your Google Sheet.
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID_HERE/exec';

    // Global variables
    let currentQuestion = 0;
    let candidateData = {};
    let mediaRecorder;
    let recordedChunks = [];
    let isRecording = false;
    let stream;
    let interviewAnswers = [];
    let recordingTimer;
    let recordingStartTime;
    let currentSpeechUtterance;
    let hindiVoice = null; // To store the selected Hindi voice

    // Comprehensive scaffolding safety questions with categories
    const scaffoldingQuestions = [
        // Basic Knowledge
        {
            question: "‡§∏‡•ç‡§ï‡•à‡§´‡•ã‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§á‡§∏‡§ï‡§æ ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§â‡§¶‡•ç‡§¶‡•á‡§∂‡•ç‡§Ø ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?",
            category: "‡§¨‡•Å‡§®‡§ø‡§Ø‡§æ‡§¶‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä",
            difficulty: "easy"
        },
        {
            question: "‡§∏‡•ç‡§ï‡•à‡§´‡•ã‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§™‡§æ‡§∞‡•ç‡§ü‡•ç‡§∏ ‡§ï‡•å‡§® ‡§∏‡•á ‡§π‡•à‡§Ç? ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 5 ‡§®‡§æ‡§Æ ‡§¨‡§§‡§æ‡§á‡§è‡•§",
            category: "‡§¨‡•Å‡§®‡§ø‡§Ø‡§æ‡§¶‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä",
            difficulty: "medium"
        },
        {
            question: "‡§ï‡§™‡•ç‡§≤‡•ã‡§ï ‡§∏‡•ç‡§ï‡•à‡§´‡•ã‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à ‡§î‡§∞ ‡§Ø‡§π ‡§¶‡•Ç‡§∏‡§∞‡•á ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§∏‡•á ‡§ï‡•à‡§∏‡•á ‡§Ö‡§≤‡§ó ‡§π‡•à?",
            category: "‡§¨‡•Å‡§®‡§ø‡§Ø‡§æ‡§¶‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä",
            difficulty: "medium"
        },
        
        // Components and Parts
        {
            question: "‡§¨‡•á‡§∏ ‡§™‡•ç‡§≤‡•á‡§ü ‡§î‡§∞ ‡§∏‡•ã‡§≤ ‡§™‡•ç‡§≤‡•á‡§ü ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§ï‡•ç‡§Ø‡§æ ‡§Ö‡§Ç‡§§‡§∞ ‡§π‡•à? ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§ï‡§æ ‡§∏‡§æ‡§á‡§ú‡§º ‡§¨‡§§‡§æ‡§á‡§è‡•§",
            category: "‡§ï‡§Ç‡§™‡•ã‡§®‡•á‡§Ç‡§ü‡•ç‡§∏",
            difficulty: "medium"
        },
        {
            question: "‡§≤‡•á‡§ú‡§∞‡•ç‡§∏ ‡§î‡§∞ ‡§ü‡•ç‡§∞‡§æ‡§Ç‡§∏‡•ã‡§Æ ‡§ï‡§æ ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§æ‡§Æ ‡§π‡•à? ‡§á‡§®‡§ï‡•á ‡§¨‡§ø‡§®‡§æ ‡§∏‡•ç‡§ï‡•à‡§´‡•ã‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó ‡§ï‡•ç‡§Ø‡•ã‡§Ç ‡§Ö‡§ß‡•Ç‡§∞‡•Ä ‡§π‡•à?",
            category: "‡§ï‡§Ç‡§™‡•ã‡§®‡•á‡§Ç‡§ü‡•ç‡§∏",
            difficulty: "medium"
        },
        {
            question: "‡§¨‡•ç‡§∞‡•á‡§∏‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§ï‡§ø‡§§‡§®‡•á ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§π‡§∞ ‡§è‡§ï ‡§ï‡§æ ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§æ‡§Æ ‡§π‡•à?",
            category: "‡§ï‡§Ç‡§™‡•ã‡§®‡•á‡§Ç‡§ü‡•ç‡§∏",
            difficulty: "hard"
        },
        
        // Safety Measures
        {
            question: "‡§ä‡§Ç‡§ö‡§æ‡§à ‡§™‡§∞ ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡•á ‡§∏‡§Æ‡§Ø ‡§ï‡•å‡§® ‡§∏‡•á PPE ‡§ú‡§º‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à‡§Ç? ‡§µ‡§ø‡§∏‡•ç‡§§‡§æ‡§∞ ‡§∏‡•á ‡§¨‡§§‡§æ‡§á‡§è‡•§",
            category: "‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§â‡§™‡§æ‡§Ø",
            difficulty: "medium"
        },
        {
            question: "‡§ü‡•ã ‡§¨‡•ã‡§∞‡•ç‡§° ‡§ï‡§æ ‡§∏‡§æ‡§á‡§ú‡§º ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§Ø‡§π ‡§ï‡•ç‡§Ø‡•ã‡§Ç ‡§ú‡§º‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à?",
            category: "‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§â‡§™‡§æ‡§Ø",
            difficulty: "easy"
        },
        {
            question: "‡§ó‡§æ‡§∞‡•ç‡§° ‡§∞‡•á‡§≤ ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•á‡§Ç ‡§ï‡•å‡§® ‡§∏‡•á parts ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§â‡§®‡§ï‡•Ä height ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•ã‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è?",
            category: "‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§â‡§™‡§æ‡§Ø",
            difficulty: "hard"
        },
        
        // Inspection and Safety
        {
            question: "‡§∏‡•ç‡§ï‡•à‡§´‡•ã‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó ‡§ï‡§æ inspection ‡§ï‡§¨ ‡§î‡§∞ ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è? ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§ö‡•á‡§ï ‡§™‡•â‡§á‡§Ç‡§ü‡•ç‡§∏ ‡§¨‡§§‡§æ‡§á‡§è‡•§",
            category: "‡§®‡§ø‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£",
            difficulty: "hard"
        },
        {
            question: "‡§∏‡•ç‡§ï‡•à‡§´‡•ã‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó ‡§Æ‡•á‡§Ç ‡§§‡•Ä‡§® ‡§∞‡§Ç‡§ó ‡§ï‡•á ‡§ü‡•à‡§ó ‡§ï‡§æ ‡§ï‡•ç‡§Ø‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à - Green, Yellow ‡§î‡§∞ Red?",
            category: "‡§®‡§ø‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£",
            difficulty: "medium"
        },
        {
            question: "‡§ï‡§ø‡§® ‡§™‡§∞‡§ø‡§∏‡•ç‡§•‡§ø‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§∏‡•ç‡§ï‡•à‡§´‡•ã‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó ‡§ï‡§æ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è?",
            category: "‡§®‡§ø‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£",
            difficulty: "medium"
        },
        
        // Emergency and Hazards
        {
            question: "‡§∏‡•ç‡§ï‡•à‡§´‡•ã‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó work ‡§ï‡•á ‡§¶‡•å‡§∞‡§æ‡§® ‡§ï‡•å‡§® ‡§∏‡•á ‡§Æ‡•Å‡§ñ‡•ç‡§Ø hazards ‡§π‡•ã ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç?",
            category: "‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤",
            difficulty: "medium"
        },
        {
            question: "‡§Ø‡§¶‡§ø ‡§∏‡•ç‡§ï‡•à‡§´‡•ã‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§ï‡§Æ‡•Ä ‡§Ø‡§æ damage ‡§¶‡§ø‡§ñ‡•á ‡§§‡•ã ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§ï‡•ç‡§Ø‡§æ action ‡§≤‡•á‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è?",
            category: "‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤",
            difficulty: "medium"
        },
        {
            question: "Fall protection system ‡§ï‡§¨ ‡§î‡§∞ ‡§ï‡•à‡§∏‡•á use ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è? Lifeline ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?",
            category: "‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤",
            difficulty: "hard"
        }
    ];

    // Shuffle array function
    function shuffleArray(array) {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
    }

    // Get randomized questions
    const selectedQuestions = shuffleArray(scaffoldingQuestions);

    // Function to switch visible sections
    function showSection(id) {
        document.querySelectorAll('.section').forEach(section => {
            section.classList.remove('active');
        });
        document.getElementById(id).classList.add('active');
    }

    // Send data to Google Sheets
    async function sendToGoogleSheets(data) {
        const syncStatusEl = document.getElementById('syncStatus');
        
        try {
            syncStatusEl.innerHTML = '<span>üìä ‡§°‡•á‡§ü‡§æ Google Sheet ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</span>';
            syncStatusEl.classList.remove('success', 'error'); // Reset classes

            const response = await fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors', // 'no-cors' means you won't be able to read the response from Apps Script
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });
            
            // Since mode is 'no-cors', we can't read the response directly.
            // We'll assume success if the fetch operation completes without a network error.
            syncStatusEl.innerHTML = '<span>‚úÖ ‡§°‡•á‡§ü‡§æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï Google Sheet "HAPPY SCREENING" ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡§æ! (‡§Ø‡§π ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•á‡§µ‡§≤ ‡§ï‡•ç‡§≤‡§æ‡§á‡§Ç‡§ü-‡§∏‡§æ‡§á‡§° ‡§Ö‡§®‡•Å‡§Æ‡§æ‡§® ‡§π‡•à)</span>';
            syncStatusEl.classList.add('success');
            
        } catch (error) {
            console.error('Error sending to Google Sheets:', error);
            syncStatusEl.innerHTML = '<span>‚ùå Google Sheet ‡§Æ‡•á‡§Ç ‡§°‡•á‡§ü‡§æ ‡§∏‡•á‡§µ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ü‡§à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç‡•§</span>';
            syncStatusEl.classList.add('error');
        }
    }

    // Form submission
    document.getElementById('candidateForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        candidateData = {
            name: document.getElementById('name').value,
            mobile: document.getElementById('mobile').value,
            email: document.getElementById('email').value,
            experience: document.getElementById('experience').value,
            location: document.getElementById('location').value,
            timestamp: new Date().toISOString(),
            interviewId: 'SCAFFOLD_' + Date.now()
        };

        showSection('interview');
        setupCamera();
    });

    // Setup camera
    async function setupCamera() {
        try {
            stream = await navigator.mediaDevices.getUserMedia({ 
                video: true, 
                audio: true 
            });
            
            const videoElement = document.getElementById('videoElement');
            videoElement.srcObject = stream;
            
            document.getElementById('statusText').textContent = '‡§ï‡•à‡§Æ‡§∞‡§æ ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•à - ‡§á‡§Ç‡§ü‡§∞‡§µ‡•ç‡§Ø‡•Ç ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç';
            document.getElementById('startBtn').style.display = 'block';

            // Populate voices for TTS as soon as they are available
            window.speechSynthesis.onvoiceschanged = () => {
                const voices = window.speechSynthesis.getVoices();
                hindiVoice = voices.find(voice => voice.lang === 'hi-IN' || voice.lang.startsWith('hi'));
                if (!hindiVoice) {
                    console.warn("Hindi voice not found, falling back to default voice.");
                }
            };
            // Ensure voices are loaded if already changed before event listener was set up
            if (window.speechSynthesis.getVoices().length > 0) {
                 const voices = window.speechSynthesis.getVoices();
                 hindiVoice = voices.find(voice => voice.lang === 'hi-IN' || voice.lang.startsWith('hi'));
            }
            
        } catch (err) {
            console.error('Camera access error:', err);
            document.getElementById('statusText').textContent = '‡§ï‡•à‡§Æ‡§∞‡§æ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ - ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§Ç';
            // Disable start button if camera access fails
            document.getElementById('startBtn').disabled = true;
        }
    }

    // Start interview
    function startInterview() {
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('nextBtn').style.display = 'block';
        
        currentQuestion = 0;
        showQuestion();
        updateProgress();
    }

    // Show current question
    function showQuestion() {
        if (currentQuestion < selectedQuestions.length) {
            const questionData = selectedQuestions[currentQuestion];
            
            document.getElementById('questionCounter').textContent = `‡§™‡•ç‡§∞‡§∂‡•ç‡§® ${currentQuestion + 1}/${selectedQuestions.length}`;
            document.getElementById('questionText').textContent = questionData.question;
            document.getElementById('categoryBadge').textContent = questionData.category;
            
            // Category colors
            const categoryColors = {
                '‡§¨‡•Å‡§®‡§ø‡§Ø‡§æ‡§¶‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä': '#28a745',
                '‡§ï‡§Ç‡§™‡•ã‡§®‡•á‡§Ç‡§ü‡•ç‡§∏': '#007bff',
                '‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§â‡§™‡§æ‡§Ø': '#ffc107',
                '‡§®‡§ø‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£': '#17a2b8',
                '‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤': '#dc3545'
            };
            
            document.getElementById('categoryBadge').style.background = 
                categoryColors[questionData.category] || '#28a745';
            
            // Show AI speaking indicator
            document.getElementById('aiSpeaking').style.display = 'block';
            document.getElementById('recordingTimer').style.display = 'none';
            
            // Stop any ongoing recording
            if (isRecording) {
                stopRecording();
            }
            
            // Speak question and auto-start recording
            speakQuestionAndRecord(questionData.question);
            
        } else {
            completeInterview();
        }
    }

    // Text-to-speech and auto-start recording
    function speakQuestionAndRecord(text) {
        if ('speechSynthesis' in window) {
            // Stop any ongoing speech
            window.speechSynthesis.cancel();
            
            currentSpeechUtterance = new SpeechSynthesisUtterance(text);
            currentSpeechUtterance.lang = 'hi-IN';
            currentSpeechUtterance.rate = 0.7;
            currentSpeechUtterance.pitch = 1.0;

            // Set Hindi voice if found
            if (hindiVoice) {
                currentSpeechUtterance.voice = hindiVoice;
            }
            
            // Auto-start recording when speech ends
            currentSpeechUtterance.onend = function() {
                document.getElementById('aiSpeaking').style.display = 'none';
                setTimeout(() => {
                    startRecording();
                }, 1000); // 1-second delay before recording starts
            };
            
            window.speechSynthesis.speak(currentSpeechUtterance);
        } else {
            // Fallback if TTS not supported
            document.getElementById('aiSpeaking').style.display = 'none';
            setTimeout(() => {
                startRecording();
            }, 2000); // Longer delay if no TTS
        }
    }

    // Start recording
    function startRecording() {
        if (isRecording || !stream) return; // Prevent multiple recordings or if stream not available
        
        recordedChunks = [];
        
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.ondataavailable = function(event) {
            if (event.data.size > 0) {
                recordedChunks.push(event.data);
            }
        };
        
        mediaRecorder.onstop = function() {
            const blob = new Blob(recordedChunks, { type: 'video/webm' });
            console.log('Recording saved:', blob);
            
            // Save answer data (including the blob for later upload)
            interviewAnswers.push({
                questionNumber: currentQuestion + 1,
                question: selectedQuestions[currentQuestion].question,
                category: selectedQuestions[currentQuestion].category,
                difficulty: selectedQuestions[currentQuestion].difficulty,
                recordingBlob: blob, // Store the blob directly
                recordingDuration: getRecordingDuration(),
                timestamp: new Date().toISOString()
            });
        };
        
        mediaRecorder.start();
        isRecording = true;
        recordingStartTime = Date.now();
        
        // Show recording UI
        document.getElementById('recordingTimer').style.display = 'block';
        document.getElementById('statusText').textContent = '‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°‡§ø‡§Ç‡§ó ‡§ö‡§≤ ‡§∞‡§π‡•Ä ‡§π‡•à - ‡§Ö‡§™‡§®‡§æ ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§ú‡§µ‡§æ‡§¨ ‡§¶‡•á‡§Ç';
        document.getElementById('statusDot').classList.add('recording');
        
        // Start timer
        startRecordingTimer();
    }

    // Stop recording
    function stopRecording() {
        if (mediaRecorder && mediaRecorder.state !== 'inactive') {
            mediaRecorder.stop();
            isRecording = false;
            
            // Hide recording UI
            document.getElementById('recordingTimer').style.display = 'none';
            document.getElementById('statusText').textContent = '‡§ú‡§µ‡§æ‡§¨ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§π‡•ã ‡§ó‡§Ø‡§æ - ‡§Ö‡§ó‡§≤‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§§‡•à‡§Ø‡§æ‡§∞';
            document.getElementById('statusDot').classList.remove('recording');
            
            // Stop timer
            if (recordingTimer) {
                clearInterval(recordingTimer);
            }
        }
    }

    // Start recording timer
    function startRecordingTimer() {
        recordingTimer = setInterval(() => {
            const elapsed = Date.now() - recordingStartTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            document.getElementById('timerDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);
    }

    // Get recording duration
    function getRecordingDuration() {
        if (recordingStartTime) {
            return Date.now() - recordingStartTime;
        }
        return 0;
    }

    // Next question
    function nextQuestion() {
        if (isRecording) {
            stopRecording(); // Stop recording for the current question before moving to the next
        }
        
        // Stop any ongoing speech
        if (window.speechSynthesis) {
            window.speechSynthesis.cancel();
        }
        
        currentQuestion++;
        showQuestion();
        updateProgress();
    }

    // Complete interview
    function completeInterview() {
        // Stop any ongoing recording
        if (isRecording) {
            stopRecording();
        }
        
        // Stop any ongoing speech
        if (window.speechSynthesis) {
            window.speechSynthesis.cancel();
        }
        
        // Save data (this will now include handling the blobs)
        saveInterviewData();
        
        // Stop camera and microphone tracks
        if (stream) {
            stream.getTracks().forEach(track => track.stop());
        }
        
        showSection('results');
    }

    // Save interview data and prepare for Google Sheets upload
    async function saveInterviewData() {
        const syncStatusEl = document.getElementById('syncStatus');
        syncStatusEl.innerHTML = '<span>üìä ‡§°‡•á‡§ü‡§æ Google Sheet ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</span>';
        syncStatusEl.classList.remove('success', 'error');

        const answersWithLinks = [];

        // Loop through each recorded answer and upload its blob to Google Drive
        // This part needs a Google Apps Script function on the backend to handle the file upload.
        for (const answer of interviewAnswers) {
            let videoLink = "N/A"; // Default if upload fails

            if (answer.recordingBlob) {
                try {
                    // Convert blob to base64 for sending via JSON to Apps Script
                    const base64Data = await new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onloadend = () => resolve(reader.result.split(',')[1]); // Get base64 part
                        reader.onerror = reject;
                        reader.readAsDataURL(answer.recordingBlob);
                    });

                    // Send the base64 data to Apps Script to save to Google Drive
                    // Your Google Apps Script function will need to accept this data,
                    // decode it, and save it to Google Drive, then return the file URL.
                    const uploadResponse = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'cors', // Use 'cors' if your Apps Script is configured for it, or 'no-cors' if not
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'uploadFile', // Action for your Apps Script to identify
                            fileName: `${candidateData.interviewId}_Q${answer.questionNumber}.webm`,
                            mimeType: answer.recordingBlob.type,
                            base64Data: base64Data,
                            folderId: 'YOUR_GOOGLE_DRIVE_FOLDER_ID_HERE' // IMPORTANT: Specify a folder ID for recordings
                        })
                    });

                    // If mode is 'cors', you can read the response
                    if (uploadResponse.ok) {
                        const result = await uploadResponse.json();
                        if (result && result.fileUrl) {
                            videoLink = result.fileUrl;
                        } else {
                            console.error("File upload failed:", result);
                            syncStatusEl.innerHTML = '<span>‚ùå ‡§ï‡•Å‡§õ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°‡§ø‡§Ç‡§ó ‡§Ö‡§™‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§™‡§æ‡§à‡§Ç‡•§</span>';
                            syncStatusEl.classList.add('error');
                        }
                    } else {
                         console.error("File upload failed with status:", uploadResponse.status);
                         syncStatusEl.innerHTML = '<span>‚ùå ‡§ï‡•Å‡§õ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°‡§ø‡§Ç‡§ó ‡§Ö‡§™‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§™‡§æ‡§à‡§Ç‡•§</span>';
                         syncStatusEl.classList.add('error');
                    }
                } catch (error) {
                    console.error("Error uploading recording:", error);
                    syncStatusEl.innerHTML = '<span>‚ùå ‡§ï‡•Å‡§õ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°‡§ø‡§Ç‡§ó ‡§Ö‡§™‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§™‡§æ‡§à‡§Ç‡•§</span>';
                    syncStatusEl.classList.add('error');
                }
            }

            // Prepare data for Google Sheet
            answersWithLinks.push({
                questionNumber: answer.questionNumber,
                question: answer.question,
                category: answer.category,
                difficulty: answer.difficulty,
                recordingDuration: (answer.recordingDuration / 1000).toFixed(1) + 's', // Convert ms to seconds
                recordingLink: videoLink,
                timestamp: answer.timestamp
            });
        }

        const finalData = {
            candidate: candidateData,
            answers: answersWithLinks
        };

        // Send all collected data (including recording links) to Google Sheet
        sendToGoogleSheets(finalData);
    }

    // Restart interview
    function restartInterview() {
        // Clear all data
        currentQuestion = 0;
        candidateData = {};
        interviewAnswers = [];
        recordedChunks = [];
        isRecording = false;
        if (recordingTimer) clearInterval(recordingTimer);
        
        // Reset UI
        document.getElementById('candidateForm').reset();
        document.getElementById('progressFill').style.width = '0%';
        document.getElementById('questionText').textContent = '‡§á‡§Ç‡§ü‡§∞‡§µ‡•ç‡§Ø‡•Ç ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•ã ‡§ú‡§æ‡§á‡§è...';
        document.getElementById('questionCounter').textContent = '‡§™‡•ç‡§∞‡§∂‡•ç‡§® 1/15';
        document.getElementById('categoryBadge').textContent = '‡§¨‡•Å‡§®‡§ø‡§Ø‡§æ‡§¶‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä';
        document.getElementById('statusText').textContent = '‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...';
        document.getElementById('statusDot').classList.remove('recording');
        document.getElementById('startBtn').style.display = 'block';
        document.getElementById('startBtn').disabled = false; // Re-enable if disabled previously
        document.getElementById('nextBtn').style.display = 'none';
        document.getElementById('aiSpeaking').style.display = 'none';
        document.getElementById('recordingTimer').style.display = 'none';
        document.getElementById('syncStatus').innerHTML = '<span>üìä ‡§°‡•á‡§ü‡§æ Google Sheet ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</span>';
        document.getElementById('syncStatus').classList.remove('success', 'error');

        // Show registration section
        showSection('registration');
    }

    // Initial setup on page load
    document.addEventListener('DOMContentLoaded', () => {
        showSection('registration'); // Ensure registration is the first section
        // No need to setupCamera here, as it's called after form submission
    });

</script>
</body>
</html>
